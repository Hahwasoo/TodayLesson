<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.todaylesson.Mapper.JY_US_TotalLessonMapper">


<!-- 승인 난 애들만 볼 수 있으니까 -->
<select id="ttlesson_list" resultType="com.todaylesson.DTO.LessonDTO">
<![CDATA[
select * from lesson
where lesson_result=2
and now() >= date(lesson_open_period) 
and now() <= date(lesson_close_period)
]]>
</select>


<select id="ttlesson_select" resultType="com.todaylesson.DTO.AllLessonDTO">

select * from lesson join senior
on lesson.senior_no = senior.senior_no
where lesson_no = #{lesson_no}

</select>

<update id="ttlesson_readno_plus">

update lesson 
set lesson_readno = lesson_readno + 1
where lesson_no = #{lesson_no}

</update>


<update id="ttlesson_like_count_plus">
update lesson 
set lesson_like = lesson_like + 1
where lesson_no = #{lesson_no} 
</update>

<insert id="add_like_lesson">

insert into mylike(lesson_no, member_id)
value(#{lesson_no},#{member_id})


</insert>

<insert id="add_cart_lesson">

insert into cart(lesson_no, member_id, cart_amount)
value(#{lesson_no},#{member_id},1)
</insert>

<insert id="add_lesson_reply">

insert into lesson_qa(lesson_no, member_id,lesson_qa_reply_title, lesson_qa_reply_content,lesson_qa_register_date,lesson_qa_reply_secret, lesson_qa_originno)
value(#{lesson_no},#{member_id},#{lesson_qa_reply_title},#{lesson_qa_reply_content},now(),#{lesson_qa_reply_secret},0)

</insert>



<select id="select_lesson_reply" resultType="com.todaylesson.DTO.Lesson_qaDTO">


select * from lesson_qa
where lesson_no = #{lesson_no} and lesson_qa_originno = 0

</select>

<select id="has_like_lesson" resultType="com.todaylesson.DTO.MyLikeDTO" parameterType="com.todaylesson.DTO.MyLikeDTO">

select * from mylike
where lesson_no=#{lesson_no} and member_id = #{member_id}


</select>

<select id="has_cart_lesson" resultType="com.todaylesson.DTO.CartDTO" parameterType="com.todaylesson.DTO.CartDTO">

select * from cart
where lesson_no = #{lesson_no} and member_id=#{member_id}

</select>

<insert id="add_lesson_reply_answer">


<selectKey order="BEFORE" keyProperty="lesson_qa_group" resultType="integer">
select ifnull(max(lesson_qa_group),0)
from lesson_qa 
where lesson_no = #{lesson_no} and lesson_qa_originno = #{lesson_qa_originno}
</selectKey>
<!-- 답글 여러개는 버리자 걍ㅎ 시간 나면 해 -->
insert into lesson_qa(lesson_no, member_id, lesson_qa_originno, lesson_qa_answer_content,lesson_qa_group, lesson_qa_register_date, lesson_qa_reply_secret )
value (#{lesson_no},#{member_id},#{lesson_qa_originno},#{lesson_qa_answer_content}, #{lesson_qa_group}+1, now(), #{lesson_qa_reply_secret})

</insert>

<select id="select_lesson_reply_answer" resultType="com.todaylesson.DTO.Lesson_qaDTO">

select lesson_qa_no,lesson_qa_answer_content, lesson_qa_originno,lesson_qa_register_date,member_id
from lesson_qa
where lesson_qa_originno != 0 and lesson_no = #{lesson_no}

</select>


<select id="has_answer_reply" resultType="integer">

select ifnull(max(lesson_qa_group),0)
from lesson_qa
where lesson_no = #{lesson_no} and lesson_qa_originno = #{lesson_qa_originno}

</select>

</mapper>