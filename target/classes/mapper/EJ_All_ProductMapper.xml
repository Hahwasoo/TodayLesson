<?xml version="1.0" encoding="UTF-8"?>  <!-- 해당하는 xml을 mybatis와 관련된 규칙으로 한다. -->
<!DOCTYPE mapper 
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  

<mapper namespace="com.todaylesson.Mapper.EJ_US_ProductMapper">



<select id="allData" resultType="com.todaylesson.DTO.ProductDTO">
select *
from product
</select>


<!-- 게시판 insert -->
<insert id="insertBoard" parameterType="com.todaylesson.DTO.ProductDTO">
INSERT INTO product (product_name, product_cost, product_stock, product_content, product_img, product_thumb, product_category, product_sale, product_after_cost, product_date)
				VALUES (#{product_name},#{product_cost},#{product_stock},#{product_content},#{product_img},#{product_thumb}, #{product_category}, #{product_sale}, #{product_after_cost}
				,now())
</insert>


<select id="selectBoard" parameterType="int" resultType="com.todaylesson.DTO.ProductDTO">
select *
from product
where product_no=#{product_no}
</select>


 <select id="selectReply" resultType="com.todaylesson.DTO.PdReviewDTO">
select *
from pdreview, orderlist, order_detail
where pdreview.orderlist_no=orderlist.orderlist_no
and orderlist.orderlist_no=order_detail.orderlist_no
and product_no=#{product_no}
</select> 


<insert id="registReply" parameterType="com.todaylesson.DTO.PdReviewDTO">
 <selectKey resultType="int" keyProperty="orderlist_no" order="BEFORE">
select orderlist.orderlist_no from orderlist, order_detail 
 	where order_detail.orderlist_no=orderlist.orderlist_no and product_no=#{product_no} and member_id=#{member_id}
 </selectKey>
 insert into pdreview(orderlist_no, pdreview_content, pdreview_date)
 values (#{orderlist_no},#{pdreview_content},sysdate())
</insert>

<select id="selectMember" parameterType="String" resultType="com.todaylesson.DTO.MemberDTO">
select *
from member
where member_id=#{member_id}
</select>
<!-- 게시판 insert -->
<insert id="insertOption" parameterType="com.todaylesson.DTO.OptionsDTO">
INSERT INTO options (product_no, option_name, option_cost)
				VALUES (#{product_no}, #{option_name}, #{option_cost})
</insert>

	
	<select id="selectOption" resultType="com.todaylesson.DTO.OptionsDTO">
	select *
from options
where  product_no=#{product_no}
	</select>
	
	<insert id="insertorderlist" parameterType="com.todaylesson.DTO.OrderListDTO">
	insert into orderlist(member_id,orderlist_receiver,orderlist_phone,orderlist_addr
	,orderlist_date,orderlist_orderstatus,orderlist_cost
	,orderlist_paystatus,orderlist_calculatestatus,orderlist_usepoint)
	values (#{member_id},#{orderlist_receiver},#{orderlist_phone},#{orderlist_addr},
	sysdate(),1,#{orderlist_cost},1,1,0)
	</insert>
	
	<insert id="insertorderdetail" parameterType="com.todaylesson.DTO.OrderDetailDTO">
	<selectKey resultType="int" keyProperty="orderlist_no" order="BEFORE">
	select max(orderlist_no) as orderlist_no from orderlist
	</selectKey>
	insert into order_detail (orderlist_no,product_no,order_count)
	 values(#{orderlist_no},#{product_no},#{order_count})
	</insert>
	
</mapper> 